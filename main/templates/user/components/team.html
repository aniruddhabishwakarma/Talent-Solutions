{% load static %}

<!-- Team Section -->
<section id="team" class="bg-white py-2">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20 pb-30">

        <!-- Top Header Row -->
        <div class="grid lg:grid-cols-2 gap-10 items-start mb-12">
            <div>
                <span class="inline-flex items-center justify-center px-10 py-2 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-semibold tracking-widest uppercase shadow-sm">
                    OUR TEAM
                </span>
                <h2 class="mt-8 text-4xl sm:text-5xl font-extrabold text-gray-900 leading-tight">
                    Experienced Team <br />
                    Behind Every Success
                </h2>
            </div>
        </div>

        <!-- Team Slider -->
        {% if team_members %}

        <!-- ── MOBILE: circular single-card carousel (hidden on md+) ── -->
        <div class="md:hidden relative px-12">

            <button onclick="scrollTeamMobile(-1)"
                class="absolute left-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 flex items-center justify-center rounded-full bg-white border border-gray-200 shadow-md hover:bg-[#00346B] hover:text-white hover:border-[#00346B] transition text-gray-600">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </button>

            <div class="overflow-hidden max-w-xs mx-auto">
                <div id="team-track-mobile" class="flex transition-transform duration-500 ease-in-out">
                    {% for member in team_members %}
                    <div class="flex-none w-full bg-white rounded-xl shadow-md overflow-hidden group">

                        <!-- Circular Photo -->
                        <div class="flex justify-center pt-6 pb-2">
                            <div class="w-32 h-32 rounded-full overflow-hidden border-4 border-[#00346B]/20 shadow-lg bg-gradient-to-br from-[#071a33] to-[#134a96]">
                                <img src="{{ member.photo.url }}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" alt="{{ member.name }}" />
                            </div>
                        </div>

                        <div class="h-1 bg-gradient-to-r from-[#00346B] to-[#134a96] mx-4 rounded-full mt-4"></div>

                        <div class="px-4 pt-4 pb-3">
                            <h3 class="text-base font-bold text-gray-900 text-center">{{ member.name }}</h3>
                            <p class="text-[#00346B] text-sm font-medium text-center mt-0.5 mb-4">{{ member.position }}</p>
                            <div class="flex items-center justify-between pt-3 border-t border-gray-100">
                                <div class="flex items-center gap-3 text-base">
                                    {% if member.facebook_url %}<a href="{{ member.facebook_url }}" target="_blank" rel="noopener"><i class="fab fa-facebook-f text-gray-400 hover:text-blue-600 transition"></i></a>{% endif %}
                                    {% if member.instagram_url %}<a href="{{ member.instagram_url }}" target="_blank" rel="noopener"><i class="fab fa-instagram text-gray-400 hover:text-pink-500 transition"></i></a>{% endif %}
                                    {% if member.whatsapp_url %}<a href="{{ member.whatsapp_url }}" target="_blank" rel="noopener"><i class="fab fa-whatsapp text-gray-400 hover:text-green-500 transition"></i></a>{% endif %}
                                </div>
                                <button onclick="openTeamModal(this)"
                                    data-name="{{ member.name }}" data-position="{{ member.position }}"
                                    data-bio="{{ member.bio }}" data-photo="{{ member.photo.url }}"
                                    data-facebook="{{ member.facebook_url|default:'' }}"
                                    data-instagram="{{ member.instagram_url|default:'' }}"
                                    data-whatsapp="{{ member.whatsapp_url|default:'' }}"
                                    class="group flex items-center gap-1 text-xs font-semibold text-[#00346B] hover:text-[#134a96] transition-colors">
                                    View Details
                                    <svg class="w-3 h-3 group-hover:translate-x-0.5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <button onclick="scrollTeamMobile(1)"
                class="absolute right-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 flex items-center justify-center rounded-full bg-white border border-gray-200 shadow-md hover:bg-[#00346B] hover:text-white hover:border-[#00346B] transition text-gray-600">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </button>
        </div>

        <!-- ── DESKTOP: original horizontal scroll (hidden on mobile) ── -->
        <div class="hidden md:block relative">

            <button id="team-prev" onclick="scrollTeamDesktop(-1)"
                class="hidden absolute left-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 items-center justify-center bg-white border border-gray-200 rounded-full shadow-md hover:bg-[#00346B] hover:text-white hover:border-[#00346B] transition text-gray-600 -translate-x-5">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </button>

            <div id="team-scroll" class="flex gap-16 overflow-x-auto scroll-smooth pb-3 px-1"
                style="scrollbar-width: none; -ms-overflow-style: none;">
                {% for member in team_members %}
                <div class="flex-none w-72 bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 overflow-hidden group">

                    <div class="h-52 w-full bg-gradient-to-br from-[#071a33] to-[#134a96] overflow-hidden">
                        <img src="{{ member.photo.url }}" class="w-full h-full object-contain object-bottom group-hover:scale-105 transition-transform duration-500" alt="{{ member.name }}" />
                    </div>

                    <div class="h-1 bg-gradient-to-r from-[#00346B] to-[#134a96]"></div>

                    <div class="px-4 pt-4 pb-3">
                        <h3 class="text-base font-bold text-gray-900 text-center">{{ member.name }}</h3>
                        <p class="text-[#00346B] text-sm font-medium text-center mt-0.5 mb-4">{{ member.position }}</p>
                        <div class="flex items-center justify-between pt-3 border-t border-gray-100">
                            <div class="flex items-center gap-3 text-base">
                                {% if member.facebook_url %}<a href="{{ member.facebook_url }}" target="_blank" rel="noopener" title="Facebook"><i class="fab fa-facebook-f text-gray-400 hover:text-blue-600 transition"></i></a>{% endif %}
                                {% if member.instagram_url %}<a href="{{ member.instagram_url }}" target="_blank" rel="noopener" title="Instagram"><i class="fab fa-instagram text-gray-400 hover:text-pink-500 transition"></i></a>{% endif %}
                                {% if member.whatsapp_url %}<a href="{{ member.whatsapp_url }}" target="_blank" rel="noopener" title="WhatsApp"><i class="fab fa-whatsapp text-gray-400 hover:text-green-500 transition"></i></a>{% endif %}
                            </div>
                            <button onclick="openTeamModal(this)"
                                data-name="{{ member.name }}" data-position="{{ member.position }}"
                                data-bio="{{ member.bio }}" data-photo="{{ member.photo.url }}"
                                data-facebook="{{ member.facebook_url|default:'' }}"
                                data-instagram="{{ member.instagram_url|default:'' }}"
                                data-whatsapp="{{ member.whatsapp_url|default:'' }}"
                                class="group flex items-center gap-1 text-xs font-semibold text-[#00346B] hover:text-[#134a96] transition-colors">
                                View Details
                                <svg class="w-3 h-3 group-hover:translate-x-0.5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <button id="team-next" onclick="scrollTeamDesktop(1)"
                class="hidden absolute right-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 items-center justify-center bg-white border border-gray-200 rounded-full shadow-md hover:bg-[#00346B] hover:text-white hover:border-[#00346B] transition text-gray-600 translate-x-5">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </button>
        </div>
        {% else %}
        <div class="text-center py-20">
            <i class="fa-solid fa-users text-gray-300" style="font-size: 64px; margin-bottom: 16px;"></i>
            <p class="text-gray-400">No team members added yet.</p>
        </div>
        {% endif %}

    </div>
</section>

<!-- Team Member Modal -->
<div id="teamModal" class="fixed inset-0 z-[100] hidden items-center justify-center p-2 sm:p-4" aria-modal="true" role="dialog">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeTeamModal()"></div>

    <!-- Modal Card -->
    <div class="relative z-10 bg-white rounded-2xl shadow-2xl w-full max-w-[98vw] sm:max-w-lg mx-auto overflow-hidden h-[90vh] flex flex-col">

        <!-- Close -->
        <button onclick="closeTeamModal()"
            class="absolute top-3 right-3 z-10 w-8 h-8 flex items-center justify-center rounded-full bg-white/20 hover:bg-white/30 transition text-white">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>

        <!-- Header -->
        <div class="bg-gradient-to-br from-[#071a33] to-[#134a96] px-6 pt-8 pb-7 text-center flex-shrink-0">
            <div class="w-28 h-28 rounded-full overflow-hidden mx-auto border-4 border-white/30 shadow-xl mb-4 bg-white/10">
                <img id="modal-photo" src="" alt="" class="w-full h-full object-contain object-bottom" />
            </div>
            <h3 id="modal-name" class="text-xl font-bold text-white"></h3>
            <p id="modal-position" class="text-blue-200 text-sm font-medium mt-1"></p>
            <div id="modal-socials" class="mt-4 flex gap-3 justify-center"></div>
        </div>

        <!-- Body -->
        <div class="p-6 overflow-y-auto flex-1">
            <p class="text-xs font-semibold text-gray-400 uppercase tracking-widest mb-3">About</p>
            <p id="modal-bio" class="text-gray-700 text-sm leading-relaxed whitespace-pre-line"></p>
        </div>

        <!-- Navigation Footer -->
        <div class="flex items-center justify-between px-6 py-4 border-t border-gray-100 flex-shrink-0">
            <button onclick="navigateModal(-1)"
                class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 hover:bg-[#00346B] hover:text-white transition-all duration-200 text-gray-600">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            <button onclick="navigateModal(1)"
                class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 hover:bg-[#00346B] hover:text-white transition-all duration-200 text-gray-600">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </button>
        </div>
    </div>
</div>

<script>
/* ── Mobile: circular single-card carousel ── */
let teamMobileIndex = 0;
let teamMobileTotal = 0;

function scrollTeamMobile(dir) {
    const track = document.getElementById('team-track-mobile');
    if (!track || teamMobileTotal === 0) return;
    teamMobileIndex = (teamMobileIndex + dir + teamMobileTotal) % teamMobileTotal;
    const cardWidth = track.children[0].offsetWidth;
    track.style.transform = `translateX(-${teamMobileIndex * cardWidth}px)`;
}

/* ── Desktop: overflow scroll with show/hide arrows ── */
function scrollTeamDesktop(dir) {
    const el = document.getElementById('team-scroll');
    if (el) el.scrollBy({ left: dir * 308, behavior: 'smooth' });
}

function updateTeamDesktopSlider() {
    const el = document.getElementById('team-scroll');
    const prev = document.getElementById('team-prev');
    const next = document.getElementById('team-next');
    if (!el) return;
    const overflow = el.scrollWidth > el.clientWidth + 4;
    el.style.justifyContent = overflow ? 'flex-start' : 'center';
    if (overflow) {
        const atStart = el.scrollLeft <= 4;
        const atEnd = el.scrollLeft >= el.scrollWidth - el.clientWidth - 4;
        prev.classList.toggle('hidden', atStart);
        prev.classList.toggle('flex', !atStart);
        next.classList.toggle('hidden', atEnd);
        next.classList.toggle('flex', !atEnd);
    } else {
        prev.classList.add('hidden'); prev.classList.remove('flex');
        next.classList.add('hidden'); next.classList.remove('flex');
    }
}

document.addEventListener('DOMContentLoaded', function () {
    // Mobile init
    const mobileTrack = document.getElementById('team-track-mobile');
    if (mobileTrack) teamMobileTotal = mobileTrack.children.length;

    // Desktop init
    const desktopEl = document.getElementById('team-scroll');
    if (desktopEl) {
        updateTeamDesktopSlider();
        desktopEl.addEventListener('scroll', updateTeamDesktopSlider);
        window.addEventListener('resize', updateTeamDesktopSlider);
    }
});

/* ── Modal ── */
let teamMembers = [];
let currentMemberIndex = 0;

document.addEventListener('DOMContentLoaded', function () {
    teamMembers = Array.from(document.querySelectorAll('[data-name][data-photo]')).map(btn => ({
        name:      btn.dataset.name,
        position:  btn.dataset.position,
        bio:       btn.dataset.bio,
        photo:     btn.dataset.photo,
        facebook:  btn.dataset.facebook  || '',
        instagram: btn.dataset.instagram || '',
        whatsapp:  btn.dataset.whatsapp  || '',
    }));
});

function renderModal(member) {
    document.getElementById('modal-photo').src = member.photo;
    document.getElementById('modal-photo').alt = member.name;
    document.getElementById('modal-name').textContent = member.name;
    document.getElementById('modal-position').textContent = member.position;
    document.getElementById('modal-bio').textContent = member.bio;

    const socials = document.getElementById('modal-socials');
    socials.innerHTML = '';
    if (member.facebook) socials.innerHTML += `
        <a href="${member.facebook}" target="_blank" rel="noopener" title="Facebook"
           class="w-9 h-9 flex items-center justify-center rounded-full border border-white/30 text-white/70 hover:bg-white hover:text-[#00346B] hover:border-white transition">
            <i class="fab fa-facebook-f text-sm"></i>
        </a>`;
    if (member.instagram) socials.innerHTML += `
        <a href="${member.instagram}" target="_blank" rel="noopener" title="Instagram"
           class="w-9 h-9 flex items-center justify-center rounded-full border border-white/30 text-white/70 hover:bg-white hover:text-[#00346B] hover:border-white transition">
            <i class="fab fa-instagram text-sm"></i>
        </a>`;
    if (member.whatsapp) socials.innerHTML += `
        <a href="${member.whatsapp}" target="_blank" rel="noopener" title="WhatsApp"
           class="w-9 h-9 flex items-center justify-center rounded-full border border-white/30 text-white/70 hover:bg-white hover:text-[#00346B] hover:border-white transition">
            <i class="fab fa-whatsapp text-sm"></i>
        </a>`;
}

function openTeamModal(btn) {
    currentMemberIndex = teamMembers.findIndex(m => m.name === btn.dataset.name && m.photo === btn.dataset.photo);
    if (currentMemberIndex === -1) currentMemberIndex = 0;
    renderModal(teamMembers[currentMemberIndex]);
    const modal = document.getElementById('teamModal');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
    document.body.style.overflow = 'hidden';
}

function navigateModal(dir) {
    currentMemberIndex = (currentMemberIndex + dir + teamMembers.length) % teamMembers.length;
    renderModal(teamMembers[currentMemberIndex]);
}

function closeTeamModal() {
    const modal = document.getElementById('teamModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
    document.body.style.overflow = '';
}

document.addEventListener('keydown', e => {
    if (e.key === 'Escape') closeTeamModal();
    if (e.key === 'ArrowLeft') navigateModal(-1);
    if (e.key === 'ArrowRight') navigateModal(1);
});
</script>
