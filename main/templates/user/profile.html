{% extends 'user/base.html' %}

{% block title %}My Profile - Talent Solutions{% endblock %}

{% block body_class %}bg-gray-50{% endblock %}
{% block main_class %}pt-20{% endblock %}

{% block content %}
<!-- Page Header -->
<section class="bg-white border-b border-gray-100">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <h1 class="text-2xl font-bold text-gray-900">My Profile</h1>
        <p class="text-gray-500 mt-1">Manage your personal information and documents</p>
    </div>
</section>

<!-- Content -->
<section class="py-8 sm:py-12">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid lg:grid-cols-3 gap-8">

            <!-- Left: Avatar Card -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-2xl shadow-sm p-6 text-center sticky top-24">
                    <!-- Avatar -->
                    <div class="w-28 h-28 mx-auto rounded-full overflow-hidden border-4 border-gray-100 shadow-md">
                        {% if user.profile_picture %}
                            <img src="{{ user.profile_picture.url }}" alt="{{ user.username }}" class="w-full h-full object-cover">
                        {% elif user.profile_picture_url %}
                            <img src="{{ user.profile_picture_url }}" alt="{{ user.username }}" class="w-full h-full object-cover">
                        {% else %}
                            <div class="w-full h-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center">
                                <span class="text-white text-4xl font-bold">{{ user.first_name|first|upper }}{{ user.last_name|first|upper }}</span>
                            </div>
                        {% endif %}
                    </div>

                    <h2 class="text-xl font-bold text-gray-900 mt-4">
                        {% if user.first_name %}{{ user.first_name }} {{ user.last_name }}{% else %}{{ user.username }}{% endif %}
                    </h2>
                    <p class="text-gray-500 text-sm mt-1">{{ user.email }}</p>

                    <div class="mt-4">
                        <span class="inline-block px-3 py-1 bg-cyan-50 text-cyan-700 text-xs font-semibold rounded-full">
                            {{ user.get_role_display }}
                        </span>
                        {% if user.auth_provider == 'google' %}
                        <span class="inline-block px-3 py-1 bg-orange-50 text-orange-600 text-xs font-semibold rounded-full ml-2">
                            Google
                        </span>
                        {% endif %}
                    </div>

                    <!-- Stats -->
                    <div class="mt-6 pt-6 border-t border-gray-100 grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-2xl font-bold text-gray-900">{{ user.job_applications.count }}</p>
                            <p class="text-xs text-gray-500">Applications</p>
                        </div>
                        <div>
                            <p class="text-2xl font-bold text-gray-900">{{ user.user_skills.count }}</p>
                            <p class="text-xs text-gray-500">Skills</p>
                        </div>
                    </div>

                    <!-- Logout -->
                    <div class="mt-6 pt-6 border-t border-gray-100">
                        <a href="{% url 'user_logout' %}" class="text-sm text-red-500 hover:text-red-600 font-medium transition-colors flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                            </svg>
                            Logout
                        </a>
                    </div>
                </div>
            </div>

            <!-- Right: Profile + Documents -->
            <div class="lg:col-span-2 space-y-6">

                <!-- Profile Section -->
                <div class="bg-white rounded-2xl shadow-sm">
                    <div class="flex items-center justify-between px-6 py-5 border-b border-gray-100">
                        <h3 class="text-lg font-bold text-gray-900 flex items-center gap-2">
                            <svg class="w-5 h-5 text-cyan-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                            Personal Information
                        </h3>
                        <a href="{% url 'edit_profile' %}" class="text-sm text-cyan-600 hover:text-cyan-700 font-semibold flex items-center gap-1 transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                            </svg>
                            Edit
                        </a>
                    </div>

                    <div class="p-6">
                        <div class="grid sm:grid-cols-2 gap-6">
                            <div>
                                <p class="text-xs text-gray-500 font-semibold uppercase tracking-wider mb-1">Full Name</p>
                                <p class="text-gray-900 font-medium">{% if user.first_name %}{{ user.first_name }} {{ user.last_name }}{% else %}Not set{% endif %}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 font-semibold uppercase tracking-wider mb-1">Username</p>
                                <p class="text-gray-900 font-medium">{{ user.username }}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 font-semibold uppercase tracking-wider mb-1">Email</p>
                                <p class="text-gray-900 font-medium">{{ user.email }}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 font-semibold uppercase tracking-wider mb-1">Phone Number</p>
                                <p class="text-gray-900 font-medium">{% if user.phone_number %}{{ user.phone_number }}{% else %}<span class="text-gray-400 italic">Not provided</span>{% endif %}</p>
                            </div>
                            <div class="sm:col-span-2">
                                <p class="text-xs text-gray-500 font-semibold uppercase tracking-wider mb-1">Address</p>
                                <p class="text-gray-900 font-medium">{% if user.address %}{{ user.address }}{% else %}<span class="text-gray-400 italic">Not provided</span>{% endif %}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 font-semibold uppercase tracking-wider mb-1">Member Since</p>
                                <p class="text-gray-900 font-medium">{{ user.created_at|date:"F d, Y" }}</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 font-semibold uppercase tracking-wider mb-1">Last Updated</p>
                                <p class="text-gray-900 font-medium">{{ user.updated_at|date:"F d, Y" }}</p>
                            </div>
                        </div>

                        <!-- Skills -->
                        <div class="mt-6 pt-6 border-t border-gray-100">
                            <p class="text-xs text-gray-500 font-semibold uppercase tracking-wider mb-3">Skills</p>
                            {% if user.user_skills.exists %}
                            <div class="flex flex-wrap gap-2">
                                {% for skill in user.user_skills.all %}
                                <span class="px-3 py-1 bg-cyan-50 text-cyan-700 rounded-lg text-sm font-medium">{{ skill.name }}</span>
                                {% endfor %}
                            </div>
                            {% else %}
                            <p class="text-gray-400 italic text-sm">No skills added yet</p>
                            {% endif %}
                        </div>

                        <!-- Change password link (only for non-Google users) -->
                        {% if not user.is_google_user %}
                        <div class="mt-6 pt-6 border-t border-gray-100">
                            <a href="{% url 'change_password' %}" class="text-sm text-cyan-600 hover:text-cyan-700 font-semibold flex items-center gap-2 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                                </svg>
                                Change Password
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Documents Section -->
                <div class="bg-white rounded-2xl shadow-sm">
                    <div class="flex items-center justify-between px-6 py-5 border-b border-gray-100">
                        <h3 class="text-lg font-bold text-gray-900 flex items-center gap-2">
                            <svg class="w-5 h-5 text-cyan-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            Documents
                        </h3>
                        <a href="{% url 'edit_documents' %}" class="text-sm text-cyan-600 hover:text-cyan-700 font-semibold flex items-center gap-1 transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                            </svg>
                            Edit
                        </a>
                    </div>

                    <div class="p-6">
                        <div class="grid sm:grid-cols-3 gap-6">
                            <!-- Passport Number -->
                            <div>
                                <p class="text-xs text-gray-500 font-semibold uppercase tracking-wider mb-2">Passport Number</p>
                                {% if document.passport_number %}
                                <p class="text-gray-900 font-medium">{{ document.passport_number }}</p>
                                {% else %}
                                <p class="text-gray-400 italic text-sm">Not provided</p>
                                {% endif %}
                            </div>

                            <!-- Passport Photo -->
                            <div>
                                <p class="text-xs text-gray-500 font-semibold uppercase tracking-wider mb-2">Passport Photo</p>
                                {% if document.passport_photo %}
                                <div class="w-24 h-24 rounded-lg overflow-hidden border border-gray-200">
                                    <img src="{{ document.passport_photo.url }}" alt="Passport photo" class="w-full h-full object-cover">
                                </div>
                                {% else %}
                                <div class="w-24 h-24 rounded-lg border-2 border-dashed border-gray-200 bg-gray-50 flex items-center justify-center">
                                    <svg class="w-8 h-8 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                    </svg>
                                </div>
                                {% endif %}
                            </div>

                            <!-- CV -->
                            <div>
                                <p class="text-xs text-gray-500 font-semibold uppercase tracking-wider mb-2">CV / Resume</p>
                                {% if document.cv %}
                                <div class="flex items-center gap-3 p-3 bg-green-50 border border-green-200 rounded-lg">
                                    <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="text-sm text-green-700 font-medium">CV uploaded</p>
                                        <a href="{{ document.cv.url }}" target="_blank" class="text-xs text-cyan-600 hover:underline">Download</a>
                                    </div>
                                </div>
                                {% else %}
                                <p class="text-gray-400 italic text-sm">No CV uploaded</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    // Force navbar into light mode on inner pages
    const navbar = document.getElementById('navbar');
    if (navbar) {
        navbar.classList.add('bg-white', 'shadow-sm');
        navbar.classList.remove('bg-slate-900/90', 'backdrop-blur-lg');
        navbar.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('text-white', 'hover:text-cyan-300');
            link.classList.add('text-gray-700', 'hover:text-cyan-500');
        });
        const logoText = navbar.querySelector('.nav-logo-text');
        if (logoText) { logoText.classList.remove('text-white'); logoText.classList.add('text-gray-900'); }
        const mobileBtn = navbar.querySelector('.nav-mobile-btn');
        if (mobileBtn) { mobileBtn.classList.remove('text-white', 'hover:bg-white/10'); mobileBtn.classList.add('text-gray-700', 'hover:bg-gray-100'); }
        const userName = navbar.querySelector('.nav-user-name');
        if (userName) { userName.classList.remove('text-white'); userName.classList.add('text-gray-700'); }
        const userChevron = navbar.querySelector('.nav-user-chevron');
        if (userChevron) { userChevron.classList.remove('text-white'); userChevron.classList.add('text-gray-700'); }
    }
</script>
{% endblock %}
