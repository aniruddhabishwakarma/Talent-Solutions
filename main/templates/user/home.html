{% extends 'user/base.html' %}

{% block title %}{{ company.company_name|default:"Talent Solutions" }} - Find Your Dream Job{% endblock %}

{% block extra_css %}
<style>
    .reveal {
        opacity: 0;
        transform: translateY(30px);
        transition: opacity 0.8s ease, transform 0.8s ease;
    }

    .reveal.active {
        opacity: 1;
        transform: translateY(0);
    }

    .reveal-children>* {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.6s ease, transform 0.6s ease;
    }

    .reveal-children.active>*:nth-child(1) {
        transition-delay: 0.1s;
    }

    .reveal-children.active>*:nth-child(2) {
        transition-delay: 0.2s;
    }

    .reveal-children.active>*:nth-child(3) {
        transition-delay: 0.3s;
    }

    .reveal-children.active>*:nth-child(4) {
        transition-delay: 0.4s;
    }

    .reveal-children.active>*:nth-child(5) {
        transition-delay: 0.5s;
    }

    .reveal-children.active>*:nth-child(6) {
        transition-delay: 0.6s;
    }

    .reveal-children.active>* {
        opacity: 1;
        transform: translateY(0);
    }
</style>
{% endblock %}

{# IMPORTANT: keep this as gradient-bg so navbar text can switch dark/light per section properly #}
{% block body_class %}gradient-bg{% endblock %}
{% block main_class %}{% endblock %}


{% block content %}
{% include "user/components/hero.html" %}
{% include "user/components/about.html" %}
{% include "user/components/services.html" %}
{% include "user/components/jobs.html" %}
{% include "user/components/contact.html" %}
{% endblock %}

{% block footer %}{% endblock %}

{% block extra_js %}
<script>
    // ===== Scroll reveal animation =====
    function revealOnScroll() {
        const reveals = document.querySelectorAll('.reveal, .reveal-children');
        const windowHeight = window.innerHeight;

        reveals.forEach(el => {
            const top = el.getBoundingClientRect().top;
            if (top < windowHeight - 150) el.classList.add('active');
        });
    }

    window.addEventListener('scroll', revealOnScroll);
    window.addEventListener('load', revealOnScroll);

    // ===== Jobs carousel =====
    (function () {
        const track = document.getElementById('carousel-track');
        const prevBtn = document.getElementById('carousel-prev');
        const nextBtn = document.getElementById('carousel-next');
        if (!track || !prevBtn || !nextBtn) return;

        let currentIndex = 0;

        function getCardWidth() {
            const card = track.children[0];
            if (!card) return 0;
            return card.offsetWidth + 16; // gap-4 = 16px
        }

        function visibleCount() {
            return Math.floor(track.parentElement.offsetWidth / getCardWidth()) || 1;
        }

        function maxIndex() {
            return Math.max(0, track.children.length - visibleCount());
        }

        function updateCarousel() {
            track.style.transform = 'translateX(-' + (currentIndex * getCardWidth()) + 'px)';
            prevBtn.classList.toggle('hidden', currentIndex === 0);
            nextBtn.classList.toggle('hidden', currentIndex >= maxIndex());
        }

        window.carouselSlide = function (dir) {
            currentIndex = Math.max(0, Math.min(currentIndex + dir, maxIndex()));
            updateCarousel();
        };

        updateCarousel();
        window.addEventListener('resize', () => {
            currentIndex = Math.min(currentIndex, maxIndex());
            updateCarousel();
        });
    })();

    // ===== NAVBAR COLOR LOGIC (HOME PAGE ONLY) =====
    (function () {
        const navbar = document.getElementById('navbar');
        const heroSection = document.getElementById('hero-section');

        // If hero doesn't exist, don't run (prevents breaking other pages)
        if (!navbar || !heroSection) return;

        const sections = document.querySelectorAll('section');

        const navLinks = navbar.querySelectorAll('.nav-link');
        const navLogoText = navbar.querySelector('.nav-logo-text');
        const navMobileBtn = navbar.querySelector('.nav-mobile-btn');
        const navUserName = navbar.querySelector('.nav-user-name');
        const navUserChevron = navbar.querySelector('.nav-user-chevron');

        // These IDs must exist on your sections
        const darkSections = ['hero-section', 'services', 'contact'];

        function updateNavbar() {
            const scrollPos = window.scrollY + 120;
            let currentSection = 'hero-section';
            let isDarkSection = true;

            sections.forEach(section => {
                if (!section.id) return;

                const top = section.offsetTop;
                const bottom = top + section.offsetHeight;

                if (scrollPos >= top && scrollPos < bottom) {
                    currentSection = section.id;
                    isDarkSection = darkSections.includes(section.id);
                }
            });

            if (isDarkSection) {
                // Dark background -> white text
                if (window.scrollY > 50) {
                    navbar.classList.add('bg-slate-900/90', 'backdrop-blur-lg');
                } else {
                    navbar.classList.remove('bg-slate-900/90', 'backdrop-blur-lg');
                }
                navbar.classList.remove('bg-white', 'shadow-sm');

                navLinks.forEach(link => {
                    link.classList.add('text-white', 'hover:text-cyan-300');
                    link.classList.remove('text-gray-700', 'hover:text-cyan-500');
                });

                if (navLogoText) {
                    navLogoText.classList.add('text-white');
                    navLogoText.classList.remove('text-gray-900');
                }
                if (navUserName) {
                    navUserName.classList.add('text-white');
                    navUserName.classList.remove('text-gray-700');
                }
                if (navUserChevron) {
                    navUserChevron.classList.add('text-white');
                    navUserChevron.classList.remove('text-gray-700');
                }
                if (navMobileBtn) {
                    navMobileBtn.classList.add('text-white', 'hover:bg-white/10');
                    navMobileBtn.classList.remove('text-gray-700', 'hover:bg-gray-100');
                }
            } else {
                // Light background -> dark text
                navbar.classList.add('bg-white', 'shadow-sm');
                navbar.classList.remove('bg-slate-900/90', 'backdrop-blur-lg');

                navLinks.forEach(link => {
                    link.classList.remove('text-white', 'hover:text-cyan-300');
                    link.classList.add('text-gray-700', 'hover:text-cyan-500');
                });

                if (navLogoText) {
                    navLogoText.classList.remove('text-white');
                    navLogoText.classList.add('text-gray-900');
                }
                if (navUserName) {
                    navUserName.classList.remove('text-white');
                    navUserName.classList.add('text-gray-700');
                }
                if (navUserChevron) {
                    navUserChevron.classList.remove('text-white');
                    navUserChevron.classList.add('text-gray-700');
                }
                if (navMobileBtn) {
                    navMobileBtn.classList.remove('text-white', 'hover:bg-white/10');
                    navMobileBtn.classList.add('text-gray-700', 'hover:bg-gray-100');
                }
            }

            // Active underline based on section
            navLinks.forEach(link => {
                const underline = link.querySelector('.nav-underline');
                if (!underline) return;

                if (link.dataset.section === currentSection) {
                    underline.classList.remove('w-0');
                    underline.classList.add('w-full');
                } else {
                    underline.classList.remove('w-full');
                    underline.classList.add('w-0');
                }
            });
        }

        updateNavbar();
        window.addEventListener('scroll', updateNavbar);
        window.addEventListener('resize', updateNavbar);
    })();
</script>
{% endblock %}