# ───────────────────────────────────────────
# HTTP  (port 80)
# After SSL is set up, the redirect block below
# will bounce all traffic to HTTPS automatically.
# ───────────────────────────────────────────
server {
    listen       80;
    listen       [::]:80;
    server_name  talentsolutions.com.np www.talentsolutions.com.np;

    # Let's Encrypt ACME challenge endpoint (must be BEFORE the redirect!)
    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }

    # Redirect all other HTTP traffic to HTTPS
    location / {
        return 301 https://$server_name$request_uri;
    }
}

# ───────────────────────────────────────────
# HTTPS (port 443) — uncomment AFTER running certbot
# ───────────────────────────────────────────
server {
    listen       443 ssl;
    listen       [::]:443 ssl;
    server_name  talentsolutions.com.np www.talentsolutions.com.np;

    ssl_certificate      /etc/letsencrypt/live/talentsolutions.com.np/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/talentsolutions.com.np/privkey.pem;
    include              /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam          /etc/letsencrypt/ssl-dhparams.pem;

    location /media/ {
        alias /root/talent_solutions/Talent-Solutions/data/media/;
    }

    location / {
        proxy_pass         http://127.0.0.1:8002;
        proxy_set_header   Host              $host;
        proxy_set_header   X-Real-IP         $remote_addr;
        proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto $scheme;
    }
}
